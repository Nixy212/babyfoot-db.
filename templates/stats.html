<!DOCTYPE html>
<html lang="fr">
<head>
  <link rel="manifest" href="/static/manifest.json">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="BabyFoot">
  <link rel="apple-touch-icon" href="/static/images/logo.svg">
  <meta charset="UTF-8">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" crossorigin="anonymous">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stats â€” Baby-Foot Club</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='style-extended.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='responsive-mobile.css') }}">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='global-animations.css') }}">
  <script src="{{ url_for('static', filename='global-animations.js') }}" defer></script>
</head>
<body style="font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;">
<nav class="nav nav-glass">
  <div class="nav-inner">
    <a href="/dashboard" class="nav-brand">
      <div class="logo-wrapper">
        <img src="{{ url_for('static', filename='images/logo.svg') }}" alt="">
        <div class="logo-pulse"></div>
      </div>
      <span class="brand-text">Baby-Foot Club</span>
    </a>
    <div class="nav-sep"></div>
    <div class="nav-links">
      <a href="/dashboard" class="nav-link"><span class="nav-link-icon" data-bficon="home" data-size="18" style="color:currentColor"></span><span>Dashboard</span></a>
      <a href="/reservation" class="nav-link"><span class="nav-link-icon" data-bficon="calendar" data-size="18" style="color:currentColor"></span><span>RÃ©server</span></a>
      <a href="/live-score" class="nav-link"><span class="nav-link-icon" data-bficon="gamepad" data-size="18" style="color:currentColor"></span><span>Partie Live</span></a>
      <a href="/stats" class="nav-link active"><span class="nav-link-icon" data-bficon="stats" data-size="18" style="color:currentColor"></span><span>Stats</span></a>
      <a href="/top" class="nav-link"><span class="nav-link-icon" data-bficon="trophy" data-size="18" style="color:currentColor"></span><span>Classement</span></a>
    </div>
        <button class="burger" id="burger" onclick="toggleMenu()" aria-label="Menu">
      <span></span><span></span><span></span>
    </button>
    <div class="nav-right">
      <div class="user-profile-mini">
        <div class="nav-avatar" id="navAv">?</div>
        <span class="nav-username" id="navUsername"></span>
      </div>
    </div>
  </div>
</nav>
<!-- Mobile Menu -->
<div class="mobile-menu" id="mobileMenu">
  <button class="mobile-menu-close" onclick="toggleMenu()">âœ•</button>
  <a href="/dashboard">ğŸ  Dashboard</a>
  <a href="/reservation">ğŸ“… RÃ©server</a>
  <a href="/live-score">ğŸ® Partie Live</a>
  <a href="/lobby">ğŸ‘¥ Lobby</a>
  <a href="/stats" class="active">ğŸ“Š Stats</a>
  <a href="/top">ğŸ† Classement</a>
  <a href="/scores">ğŸ“‹ Historique</a>
  <a href="/settings">âš™ï¸ ParamÃ¨tres</a>
  <a href="#" onclick="logout()">ğŸšª DÃ©connexion</a>
  <button id="pwa-install-trigger" onclick="triggerPwaInstall()" style="display:none;width:100%;text-align:left;background:linear-gradient(135deg,rgba(205,127,50,0.15),rgba(205,127,50,0.05));border:1px solid rgba(205,127,50,0.4);color:#cd7f32;font-weight:700;font-size:1rem;padding:0.9rem 1.25rem;border-radius:10px;cursor:pointer;margin-top:0.5rem;font-family:inherit;">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:middle;margin-right:6px"><rect x="5" y="2" width="14" height="20" rx="2"/><path d="M9 13h6M12 10v6"/></svg>Installer l'app
  </button>
</div>
<script id="burger-script">
function toggleMenu() {
  document.getElementById("burger").classList.toggle("open");
  document.getElementById("mobileMenu").classList.toggle("open");
  document.body.style.overflow = document.getElementById("mobileMenu").classList.contains("open") ? "hidden" : "";
}
document.querySelectorAll(".mobile-menu a").forEach(a => a.addEventListener("click", () => {
  if (!a.getAttribute("onclick")) toggleMenu();
}));
const path = window.location.pathname;
document.querySelectorAll(".mobile-menu a").forEach(a => {
  if (a.getAttribute("href") === path) a.classList.add("active");
});
</script>

<div class="page">
  <div class="container" style="max-width:900px">
    <div class="page-header fade-up">
      <h1><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align:middle;display:inline-block;flex-shrink:0"><path d="M18 20V10M12 20V4M6 20v-6"/></svg> Mes Statistiques</h1>
      <p id="subttl">Chargement de vos statistiquesâ€¦</p>
    </div>

    <div class="stats-row fade-up" style="animation-delay:.05s">
      <div class="stat-cell">
        <div class="stat-label">Parties jouÃ©es</div>
        <div class="stat-val" id="sg">â€”</div>
      </div>
      <div class="stat-cell">
        <div class="stat-label">Buts marquÃ©s</div>
        <div class="stat-val gold" id="sp">â€”</div>
      </div>
      <div class="stat-cell">
        <div class="stat-label">Ratio Buts/Match</div>
        <div class="stat-val bronze" id="sr">â€”</div>
      </div>
      <div class="stat-cell">
        <div class="stat-label">âš½ Mis / ğŸ¥… Pris</div>
        <div class="stat-val amber" id="sb">â€”</div>
      </div>
      <div class="stat-cell">
        <div class="stat-label">Score moyen</div>
        <div class="stat-val" id="sa">â€”</div>
      </div>
    </div>

    <div class="card fade-up" style="animation-delay:.1s;padding:0;overflow:hidden">
      <div class="card-header" style="padding:1.5rem 2rem;border-bottom:1px solid var(--border-subtle)">
        <h3 style="font-size:1.125rem;font-weight:700;display:flex;align-items:center;gap:0.75rem">
          <span style="font-size:1rem;color:var(--bronze)">â†‘</span>
          <span>Historique rÃ©cent</span>
        </h3>
      </div>
      <div id="hist"></div>
    </div>

    <div style="text-align:center;margin-top:1.5rem">
      <a href="/dashboard" class="btn btn-ghost">â† Dashboard</a>
    </div>
  </div>
</div>

<script>
  fetch('/current_user').then(r=>r.json()).then(async d=>{
    const u=d.username; 
    if(!u) return;
    
    ProfileUtils.updateNav({username: u});
    document.getElementById('subttl').textContent=`Statistiques de ${u}`;
    
    const s=await fetch(`/user_stats/${u}`).then(r=>r.json());
    document.getElementById('sg').textContent=s.total_games??0;
    document.getElementById('sp').textContent=s.goals_scored??s.total_goals??0;
    document.getElementById('sr').textContent=s.ratio??0;
    document.getElementById('sb').textContent=`${s.goals_scored??0} / ${s.goals_conceded??0}`;
    document.getElementById('sa').textContent=s.average_score||'â€”';
    
    const h=document.getElementById('hist');
    if(!s.recent_scores?.length){ 
      h.innerHTML='<p style="padding:3rem;text-align:center;color:var(--text-tertiary);font-size:0.9375rem">Aucune partie jouÃ©e â€” rÃ©servez un crÃ©neau et lancez votre premiÃ¨re partie !</p>'; 
      return; 
    }
    
    h.innerHTML=s.recent_scores.map((sc,i)=>`
      <div class="hist-row">
        <div style="font-size:0.9375rem">
          <span style="font-weight:600">Partie #${i+1}</span>
        </div>
        <div style="display:flex;align-items:center;gap:1rem">
          <span class="hist-date">${new Date(sc.date).toLocaleDateString('fr-FR',{day:'2-digit',month:'2-digit',year:'numeric'})}</span>
          <span class="hist-score">${sc.score} pts</span>
        </div>
      </div>`).join('');
  });
</script>

<script src="{{ url_for('static', filename='icons.js') }}"></script>
<script src="{{ url_for('static', filename='profile-utils.js') }}"></script>
  <script src="/static/pwa.js" defer></script>
</body>
</html>
