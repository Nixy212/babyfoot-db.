<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#0a0a0a">
  <title>Top 10 ‚Äî Baby-Foot Club</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" crossorigin="anonymous">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='responsive-mobile.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='style-extended.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='global-animations.css') }}">
  <script src="{{ url_for('static', filename='global-animations.js') }}" defer></script>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">

  <style>
    /* ‚îÄ‚îÄ Leaderboard mobile-first ‚îÄ‚îÄ */
    .lb-list {
      overflow: hidden;
    }

    .lb-item {
      display: flex;
      align-items: center;
      gap: 0.875rem;
      padding: 0.875rem 1rem;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-subtle);
      transition: background 0.15s, transform 0.15s;
      position: relative;
    }
    .lb-item:first-child { border-radius: var(--radius-md) var(--radius-md) 0 0; }
    .lb-item:last-child  { border-bottom: none; border-radius: 0 0 var(--radius-md) var(--radius-md); }
    .lb-item.is-me {
      background: linear-gradient(90deg, rgba(205,127,50,0.18) 0%, rgba(205,127,50,0.05) 100%);
      border-left: 3px solid var(--bronze);
    }

    /* Rang */
    .lb-rank {
      font-family: 'Space Mono', monospace;
      font-weight: 800;
      font-size: 0.9rem;
      color: var(--text-tertiary);
      min-width: 28px;
      text-align: center;
      flex-shrink: 0;
    }
    .lb-rank.podium {
      font-size: 1.5rem;
      filter: drop-shadow(0 2px 6px rgba(205,127,50,0.4));
    }

    /* Avatar */
    .lb-av {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--gradient-bronze);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
      font-weight: 800;
      color: white;
      flex-shrink: 0;
    }
    .lb-av.av1 { background: linear-gradient(135deg, #ffd700, #ffb300); }
    .lb-av.av2 { background: linear-gradient(135deg, #c0c0c0, #a0a0a0); }
    .lb-av.av3 { background: linear-gradient(135deg, #cd7f32, #b8732f); }

    /* Infos */
    .lb-info {
      flex: 1;
      min-width: 0;
    }
    .lb-name {
      font-size: 0.9375rem;
      font-weight: 700;
      color: var(--text-primary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .lb-sub {
      font-size: 0.75rem;
      color: var(--text-tertiary);
      margin-top: 1px;
      white-space: nowrap;
    }

    /* Score */
    .lb-score {
      text-align: right;
      flex-shrink: 0;
    }
    .lb-score-val {
      font-family: 'Space Mono', monospace;
      font-size: 1.375rem;
      font-weight: 900;
      color: var(--bronze);
      line-height: 1;
    }
    .lb-score-label {
      font-size: 0.6875rem;
      color: var(--text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.04em;
      margin-top: 1px;
    }

    /* Podium top 3 ‚Äî l√©g√®re mise en avant */
    .lb-item:nth-child(1) .lb-score-val { color: #ffd700; }
    .lb-item:nth-child(2) .lb-score-val { color: #c0c0c0; }
    .lb-item:nth-child(3) .lb-score-val { color: #cd7f32; }

    /* Header tableau */
    .lb-header {
      display: flex;
      align-items: center;
      gap: 0.875rem;
      padding: 0.5rem 1rem;
      font-size: 0.6875rem;
      font-weight: 700;
      color: var(--text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      border-bottom: 1px solid var(--border-subtle);
    }
    .lb-header-rank { min-width: 28px; text-align: center; flex-shrink: 0; }
    .lb-header-av   { width: 40px; flex-shrink: 0; }
    .lb-header-info { flex: 1; }
    .lb-header-score{ text-align: right; flex-shrink: 0; padding-right: 2px; }

    /* Tags */
    .tag-me {
      display: inline-block;
      font-size: 0.65rem;
      padding: 1px 7px;
      border-radius: 20px;
      background: rgba(205,127,50,0.18);
      color: var(--bronze);
      font-weight: 700;
      margin-left: 5px;
      vertical-align: middle;
    }

    /* √âcran large : l√©g√®re animation au hover */
    @media (hover: hover) {
      .lb-item:hover {
        background: var(--bg-hover);
        transform: translateX(6px);
      }
      .lb-item.is-me:hover {
        background: linear-gradient(90deg, rgba(205,127,50,0.22) 0%, rgba(205,127,50,0.08) 100%);
      }
    }

    /* Desktop : on peut se permettre un peu plus d'espace */
    @media (min-width: 640px) {
      .lb-item { padding: 1rem 1.5rem; gap: 1.25rem; }
      .lb-header { padding: 0.6rem 1.5rem; gap: 1.25rem; }
      .lb-av { width: 48px; height: 48px; font-size: 1.125rem; }
      .lb-header-av { width: 48px; }
      .lb-name { font-size: 1rem; }
      .lb-score-val { font-size: 1.625rem; }
    }
  </style>
</head>
<body style="font-family: 'DM Sans', sans-serif;">

<nav class="nav nav-glass">
  <div class="nav-inner">
    <a href="/dashboard" class="nav-brand">
      <div class="logo-wrapper">
        <img src="{{ url_for('static', filename='images/logo.svg') }}" alt="">
        <div class="logo-pulse"></div>
      </div>
      <span class="brand-text">Baby-Foot Club</span>
    </a>
    <div class="nav-sep"></div>
    <div class="nav-links">
      <a href="/dashboard" class="nav-link"><span class="nav-link-icon" data-bficon="home" data-size="18" style="color:currentColor"></span><span>Dashboard</span></a>
      <a href="/reservation" class="nav-link"><span class="nav-link-icon" data-bficon="calendar" data-size="18" style="color:currentColor"></span><span>R√©server</span></a>
      <a href="/live-score" class="nav-link"><span class="nav-link-icon" data-bficon="gamepad" data-size="18" style="color:currentColor"></span><span>Partie Live</span></a>
      <a href="/stats" class="nav-link"><span class="nav-link-icon" data-bficon="stats" data-size="18" style="color:currentColor"></span><span>Stats</span></a>
      <a href="/top" class="nav-link active"><span class="nav-link-icon" data-bficon="trophy" data-size="18" style="color:currentColor"></span><span>Top 10</span></a>
    </div>
    <button class="burger" id="burger" onclick="toggleMenu()" aria-label="Menu">
      <span></span><span></span><span></span>
    </button>
    <div class="nav-right">
      <div class="user-profile-mini">
        <div class="nav-avatar" id="navAv">?</div>
        <span class="nav-username" id="navUsername"></span>
      </div>
      <button class="btn btn-ghost" style="margin-left:1rem" onclick="logout()"><span data-bficon="logout" data-size="16" style="color:currentColor"></span> D√©connexion</button>
    </div>
  </div>
</nav>

<div class="mobile-menu" id="mobileMenu">
  <button class="mobile-menu-close" onclick="toggleMenu()">‚úï</button>
  <a href="/dashboard"><span data-bficon="home" data-size="16"></span> Dashboard</a>
  <a href="/reservation"><span data-bficon="calendar" data-size="16"></span> R√©server</a>
  <a href="/live-score"><span data-bficon="gamepad" data-size="16"></span> Partie Live</a>
  <a href="/stats"><span data-bficon="stats" data-size="16"></span> Stats</a>
  <a href="/top" class="active"><span data-bficon="trophy" data-size="16"></span> Top 10</a>
  <a href="#" onclick="logout()"><span data-bficon="logout" data-size="16" style="color:currentColor"></span> D√©connexion</a>
</div>

<div class="page">
  <div class="container" style="max-width:700px">
    <div class="page-header fade-up">
      <h1>üèÜ Classement</h1>
      <p>Les meilleurs joueurs du club</p>
    </div>

    <div class="card fade-up" style="animation-delay:.05s;padding:0;overflow:hidden">
      <!-- En-t√™te colonnes -->
      <div class="lb-header">
        <div class="lb-header-rank">#</div>
        <div class="lb-header-av"></div>
        <div class="lb-header-info">Joueur</div>
        <div class="lb-header-score">Buts</div>
      </div>
      <!-- Liste -->
      <div class="lb-list" id="leaderboard">
        <div style="padding:3rem;text-align:center">
          <div class="loading-spinner" style="margin:0 auto 1rem"></div>
          <p style="color:var(--text-tertiary)">Chargement‚Ä¶</p>
        </div>
      </div>
    </div>

    <div style="text-align:center;margin-top:1.5rem;margin-bottom:2rem">
      <a href="/dashboard" class="btn btn-ghost">‚Üê Dashboard</a>
    </div>
  </div>
</div>

<script>
const PODIUM_ICONS = ['ü•á', 'ü•à', 'ü•â'];

function toggleMenu() {
  document.getElementById('burger').classList.toggle('open');
  document.getElementById('mobileMenu').classList.toggle('open');
  document.body.style.overflow = document.getElementById('mobileMenu').classList.contains('open') ? 'hidden' : '';
}

function logout() {
  fetch('/api/logout', {method:'POST'}).then(() => location.href = '/');
}

function ratio(goals, games) {
  if (!games) return '0.00';
  return (goals / games).toFixed(2);
}

fetch('/current_user').then(r => r.json()).then(d => {
  if (d && d.username) {
    document.getElementById('navAv').textContent = d.username[0].toUpperCase();
    document.getElementById('navUsername').textContent = d.username;
    loadLeaderboard(d.username);
  }
});

async function loadLeaderboard(me) {
  const el = document.getElementById('leaderboard');
  try {
    const lb = await fetch('/leaderboard').then(r => r.json());

    if (!lb || lb.length === 0) {
      el.innerHTML = `<div style="padding:3rem;text-align:center">
        <div style="font-size:3rem;opacity:0.3;margin-bottom:1rem">üèÜ</div>
        <p style="color:var(--text-tertiary)">Aucun joueur class√© pour le moment</p>
      </div>`;
      return;
    }

    el.innerHTML = lb.map((p, i) => {
      const rank = i + 1;
      const isMe = p.username === me;
      const isPodium = rank <= 3;
      const avClass = rank === 1 ? 'av1' : rank === 2 ? 'av2' : rank === 3 ? 'av3' : '';
      const games = p.total_games || 0;
      const goals = p.total_goals || 0;

      return `
        <div class="lb-item${isMe ? ' is-me' : ''}">
          <div class="lb-rank${isPodium ? ' podium' : ''}">
            ${isPodium ? PODIUM_ICONS[i] : '#' + rank}
          </div>
          <div class="lb-av ${avClass}">${p.username[0].toUpperCase()}</div>
          <div class="lb-info">
            <div class="lb-name">
              ${p.username}${isMe ? '<span class="tag-me">vous</span>' : ''}
            </div>
            <div class="lb-sub">${games} partie${games !== 1 ? 's' : ''} ¬∑ ratio ${ratio(goals, games)}</div>
          </div>
          <div class="lb-score">
            <div class="lb-score-val">${goals}</div>
            <div class="lb-score-label">buts</div>
          </div>
        </div>
      `;
    }).join('');

  } catch(e) {
    el.innerHTML = `<div style="padding:3rem;text-align:center">
      <p style="color:var(--text-tertiary)">Erreur de chargement</p>
    </div>`;
  }
}
</script>

<script src="{{ url_for('static', filename='icons.js') }}"></script>
</body>
</html>
